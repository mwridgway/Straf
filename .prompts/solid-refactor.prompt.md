Refactor selection to follow repo rules (#.github/copilot-instructions.md):
- SRP, DI via constructors, no singletons, Pimpl public classes.
- Introduce Strategy/Observer instead of if-else ladders.
- Provide GTest first, then implementation. Return a patch diff + brief rationale.
